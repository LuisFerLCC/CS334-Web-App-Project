{% extends "base.html" %}

{% block title %}Messages{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin/all.css') }}" />
  <style>
    footer {
      display: none !important;
    }
  </style>
{% endblock %}


{% block content %}
  <div class="d-flex flex-grow-1">
    <main class="container-xl mt-5">
      <section id="messages">
        <h2>Messages</h2>
        <div id="messages-container" class="my-4">
          {% for msg in messages %}
          <div class="card card-body mb-3">
            <h4 class="card-title">{{ msg.SenderName }}</h4>
            <a href="mailto:{{ msg.Email }}">{{ msg.Email }}</a>
            {% if msg.Phone %}<a class="ms-3" href="tel:{{ msg.Phone }}">{{ msg.Phone }}</a>{% endif %}
            <hr />
            <p>{{ msg.Body|replace('\n', '<br />')|safe }}</p>
            <form method="post" action="{{ url_for('messages') }}" onsubmit="return confirm('Are you sure you want to delete this message?');">
              <input type="hidden" name="message_id" value="{{ msg.MessageID }}" />
              <button type="submit" class="btn btn-outline-danger">Delete</button>
            </form>
          </div>
          {% else %}
          <p class="text-muted">No messages found.</p>
          {% endfor %}
        </div>
      </section>
    </main>


    <aside class="p-4">
        <h4 class="mb-3">Messages</h4>
        <ul id="views" class="no-bullets">
        <li><a href="{{ url_for('admin_dashboard') }}">Main dashboard</a></li>
        {% if session.get('can_manage_orders') %}
          <li><a href="{{ url_for('orders') }}">Manage active orders</a></li>
        {% endif %}
        {% if session.get('can_manage_inventory') %}
          <li><a href="{{ url_for('inventory') }}">Manage items & inventory</a></li>
        {% endif %}
        {% if session.get('can_manage_messages') %}
          <li><a href="{{ url_for('messages') }}">Manage messages</a></li>
        {% endif %}
        {% if session.get('can_manage_users') %}
          <li><a href="{{ url_for('users') }}">Manage users</a></li>
        {% endif %}
        <li><a href="{{ url_for('logout') }}">Log Out</a></li>
      </ul>
    </aside>
  </div>
{% endblock %}